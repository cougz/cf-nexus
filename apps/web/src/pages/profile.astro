---
import Layout from '../layouts/Layout.astro'
---

<Layout title="Profile">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">Profile Dashboard</h1>

    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Welcome to Nexus</h2>
      <p class="text-gray-400">
        You're successfully logged in using WebAuthn. Your session is secure with
        an HttpOnly, Secure, SameSite=Strict cookie.
      </p>
    </div>

    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Session Information</h2>
      <div class="space-y-2 text-gray-300">
        <div class="flex justify-between">
          <span>Status:</span>
          <span class="text-green-400">Active</span>
        </div>
        <div class="flex justify-between">
          <span>Auth Method:</span>
          <span>WebAuthn (Passkey)</span>
        </div>
        <div class="flex justify-between">
          <span>Cookie Security:</span>
          <span class="text-green-400">HttpOnly, Secure, SameSite=Strict</span>
    </div>
  </div>
</Layout>

<script>
  document.getElementById('logoutBtn')?.addEventListener('click', async () => {
    const messageDiv = document.getElementById('message')!

    try {
      const API_URL = import.meta.env.PUBLIC_API_URL || 'https://nexus-api.tim-9c0.workers.dev'

      const response = await fetch(`${API_URL}/auth/logout`, {
        method: 'POST',
        credentials: 'include',
      })

      if (!response.ok) {
        throw new Error('Logout failed')
      }

      messageDiv.textContent = 'Logged out successfully. Redirecting...'
      messageDiv.classList.remove('hidden')

      setTimeout(() => {
        window.location.href = '/'
      }, 1500)
    } catch (err) {
      messageDiv.textContent = 'Logout failed. Please try again.'
      messageDiv.classList.remove('hidden')
      messageDiv.classList.replace('bg-green-900/50', 'bg-red-900/50')
      messageDiv.classList.replace('border-green-700', 'border-red-700')
      messageDiv.classList.replace('text-green-300', 'text-red-300')
    }
  })
</script>
